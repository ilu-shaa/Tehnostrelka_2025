<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–§–∏–ª—å–º–æ—Ç–µ–∫–∞</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
  <header class="header">
    <div class="container">
      <h1 class="logo">üé¨ –§–∏–ª—å–º–æ—Ç–µ–∫–∞</h1>
      <nav class="auth-nav">
        {% if user.is_authenticated %}
          <a href="{% url 'profile' %}" class="btn profile-btn">üë§ {{ user.username }}</a>
          <a href="{% url 'logout' %}" class="btn logout-btn">üö™ –í—ã–π—Ç–∏</a>
        {% else %}
          <a href="{% url 'login' %}" class="btn login-btn">üîë –í–æ–π—Ç–∏</a>
          <a href="{% url 'register' %}" class="btn register-btn">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
      </nav>
    </div>
  </header>

  <main class="main-content">
    <div class="container1">
      <h2>–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤</h2>
      <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
      <form method="GET" class="search-form">
        <input type="text" 
               name="q" 
               placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ —Ä–µ–∂–∏—Å—Å—ë—Ä—É..." 
               value="{{ search_query }}" 
               class="search-input">
        <button type="submit" class="search-btn">üîç –ù–∞–π—Ç–∏</button>
      </form>

      <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä–∞–º -->
      <section class="genre-filter">
        <nav class="genre-nav">
          <a href="{% url 'combined_search' %}" class="genre-link {% if not genre %}active{% endif %}">–í—Å–µ</a>
          {% for g in genres %}
            <a href="{% url 'genre_movies' g %}" 
               class="genre-link {% if g == genre %}active{% endif %}">
              {{ g }}
            </a>
          {% endfor %}
        </nav>
      </section>

      <hr>

      <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
      {% if search_query %}
        <div class="search-results-header">
          <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "{{ search_query }}"</h3>
          <p>–ù–∞–π–¥–µ–Ω–æ —Ñ–∏–ª—å–º–æ–≤: {{ movies|length }}</p>
          <a href="{% url 'combined_search' %}" class="clear-search">√ó –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∏—Å–∫</a>
        </div>
      {% endif %}

      {% if movies %}
        <div class="movie-grid">
          {% for movie in movies %}
            <article class="movie-card">
              <div class="movie-poster">
                <img src="{% static 'posters/' %}{{ movie.poster|default:'no-image.jpg' }}" 
                     alt="{{ movie.title }}" 
                     loading="lazy">
              </div>
              <div class="movie-info">
                <h3 class="movie-title">
                  <a href="{% url 'movie_detail' movie.id %}">{{ movie.title }}</a>
                  <span class="movie-year">({{ movie.year }})</span>
                </h3>
                <div class="movie-meta">
                  <p class="movie-director">üé¨ {{ movie.author }}</p>
                  <p class="movie-genres">üè∑Ô∏è {{ movie.user_tags }}</p>
                </div>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å.</p>
      {% endif %}
    </div>
  </main>
</body>
</html>